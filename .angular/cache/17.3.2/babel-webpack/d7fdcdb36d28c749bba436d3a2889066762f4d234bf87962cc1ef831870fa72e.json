{"ast":null,"code":"import { forkJoin } from 'rxjs';\nimport { Role } from '../_models';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../_services/stock.service\";\nimport * as i2 from \"../_services/item.service\";\nimport * as i3 from \"../_services/storage-location.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"../_services/account.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nconst _c0 = (a0, a1) => [a0, a1];\nfunction StockListComponent_a_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"a\", 9);\n    i0.ɵɵtext(1, \"Add Stock\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction StockListComponent_a_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"a\", 10);\n    i0.ɵɵtext(1, \"Dispose Items\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction StockListComponent_tr_45_button_30_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function StockListComponent_tr_45_button_30_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const stock_r2 = i0.ɵɵnextContext().$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.editStock(stock_r2.id));\n    });\n    i0.ɵɵtext(1, \"Edit\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction StockListComponent_tr_45_button_31_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function StockListComponent_tr_45_button_31_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const stock_r2 = i0.ɵɵnextContext().$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.deleteStock(stock_r2.id));\n    });\n    i0.ɵɵtext(1, \"Delete\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction StockListComponent_tr_45_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"td\");\n    i0.ɵɵtext(13);\n    i0.ɵɵpipe(14, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\");\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"td\");\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"td\")(20, \"span\", 11);\n    i0.ɵɵtext(21);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(22, \"td\");\n    i0.ɵɵtext(23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"td\");\n    i0.ɵɵtext(25);\n    i0.ɵɵpipe(26, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"td\")(28, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function StockListComponent_tr_45_Template_button_click_28_listener() {\n      const stock_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.viewStock(stock_r2.id));\n    });\n    i0.ɵɵtext(29, \"View\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(30, StockListComponent_tr_45_button_30_Template, 2, 0, \"button\", 13)(31, StockListComponent_tr_45_button_31_Template, 2, 0, \"button\", 14);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const stock_r2 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.getItemName(stock_r2.itemId));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.getCategoryName(stock_r2));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.getBrandName(stock_r2));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(stock_r2.quantity);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind3(11, 17, stock_r2.price, \"PHP\", \"symbol\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind3(14, 21, stock_r2.price * stock_r2.quantity, \"PHP\", \"symbol\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(stock_r2.type);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate((stock_r2.location == null ? null : stock_r2.location.name) || \"No Location\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"badge-success\", ctx_r2.calculateAvailableStockForItem(stock_r2.itemId) > 0)(\"badge-warning\", ctx_r2.calculateAvailableStockForItem(stock_r2.itemId) === 0);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.calculateAvailableStockForItem(stock_r2.itemId), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(stock_r2.remarks);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(26, 25, stock_r2.createdAt, \"short\"));\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.hasRole(i0.ɵɵpureFunction2(28, _c0, ctx_r2.Role.SuperAdmin, ctx_r2.Role.Admin)));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.hasRole(i0.ɵɵpureFunction2(31, _c0, ctx_r2.Role.SuperAdmin, ctx_r2.Role.Admin)));\n  }\n}\nfunction StockListComponent_div_46_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"div\", 32)(2, \"span\", 33);\n    i0.ɵɵtext(3, \"Loading...\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"p\", 34);\n    i0.ɵɵtext(5, \"Loading items...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction StockListComponent_div_46_div_9_tr_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\", 42);\n    i0.ɵɵlistener(\"click\", function StockListComponent_div_46_div_9_tr_19_Template_tr_click_0_listener() {\n      const item_r9 = i0.ɵɵrestoreView(_r8).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r2.toggleDisposeItemSelection(item_r9));\n    });\n    i0.ɵɵelementStart(1, \"td\")(2, \"input\", 43);\n    i0.ɵɵlistener(\"click\", function StockListComponent_div_46_div_9_tr_19_Template_input_click_2_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      return i0.ɵɵresetView($event.stopPropagation());\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\")(10, \"span\", 44);\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const item_r9 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext(3);\n    i0.ɵɵclassProp(\"table-primary\", ctx_r2.isDisposeItemSelected(item_r9));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"checked\", ctx_r2.isDisposeItemSelected(item_r9));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r9.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r9.category);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r9.brand);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(item_r9.availableStock);\n  }\n}\nfunction StockListComponent_div_46_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 35)(1, \"div\", 36)(2, \"h6\");\n    i0.ɵɵtext(3, \"Items Available for Disposal\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 37)(5, \"table\", 38)(6, \"thead\", 39)(7, \"tr\")(8, \"th\")(9, \"input\", 40);\n    i0.ɵɵlistener(\"change\", function StockListComponent_div_46_div_9_Template_input_change_9_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.toggleAllDisposeItems($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Item\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\");\n    i0.ɵɵtext(13, \"Category\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"th\");\n    i0.ɵɵtext(15, \"Brand\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"th\");\n    i0.ɵɵtext(17, \"Available Stock\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(18, \"tbody\");\n    i0.ɵɵtemplate(19, StockListComponent_div_46_div_9_tr_19_Template, 12, 7, \"tr\", 41);\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(19);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.itemsWithStock);\n  }\n}\nfunction StockListComponent_div_46_div_10_option_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 53);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const location_r11 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", location_r11.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", location_r11.name, \" \");\n  }\n}\nfunction StockListComponent_div_46_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 45)(1, \"div\", 36)(2, \"h6\");\n    i0.ɵɵtext(3, \"Dispose Settings\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 35)(5, \"div\", 46)(6, \"label\", 47);\n    i0.ɵɵtext(7, \"Location\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"select\", 48);\n    i0.ɵɵlistener(\"change\", function StockListComponent_div_46_div_10_Template_select_change_8_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.onLocationChange($event));\n    });\n    i0.ɵɵelementStart(9, \"option\", 49);\n    i0.ɵɵtext(10, \"Select Location\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(11, StockListComponent_div_46_div_10_option_11_Template, 2, 2, \"option\", 50);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"div\", 46)(13, \"label\", 47);\n    i0.ɵɵtext(14, \"Price per Item\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"input\", 51);\n    i0.ɵɵlistener(\"input\", function StockListComponent_div_46_div_10_Template_input_input_15_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.onPriceChange($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\", 46)(17, \"label\", 47);\n    i0.ɵɵtext(18, \"Remarks\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"input\", 52);\n    i0.ɵɵlistener(\"input\", function StockListComponent_div_46_div_10_Template_input_input_19_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.onRemarksChange($event));\n    });\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(11);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.locations);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"value\", ctx_r2.disposeForm.price);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"value\", ctx_r2.disposeForm.remarks);\n  }\n}\nfunction StockListComponent_div_46_div_11_span_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" (Total: \", ctx_r2.getTotalSelectedItems(), \" items) \");\n  }\n}\nfunction StockListComponent_div_46_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 45)(1, \"div\", 36)(2, \"div\", 4)(3, \"strong\");\n    i0.ɵɵtext(4, \"Selected:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5);\n    i0.ɵɵtemplate(6, StockListComponent_div_46_div_11_span_6_Template, 2, 1, \"span\", 54);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.selectedDisposeItems.length, \" items for disposal \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.selectedDisposeItems.length > 0);\n  }\n}\nfunction StockListComponent_div_46_span_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 55);\n  }\n}\nfunction StockListComponent_div_46_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 17)(1, \"div\", 18)(2, \"div\", 19)(3, \"div\", 20)(4, \"h5\", 21);\n    i0.ɵɵtext(5, \"Dispose Items\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 22);\n    i0.ɵɵlistener(\"click\", function StockListComponent_div_46_Template_button_click_6_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.closeDisposeModal());\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 23);\n    i0.ɵɵtemplate(8, StockListComponent_div_46_div_8_Template, 6, 0, \"div\", 24)(9, StockListComponent_div_46_div_9_Template, 20, 1, \"div\", 25)(10, StockListComponent_div_46_div_10_Template, 20, 3, \"div\", 26)(11, StockListComponent_div_46_div_11_Template, 7, 2, \"div\", 26);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\", 27)(13, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function StockListComponent_div_46_Template_button_click_13_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.closeDisposeModal());\n    });\n    i0.ɵɵtext(14, \"Cancel\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"button\", 29);\n    i0.ɵɵlistener(\"click\", function StockListComponent_div_46_Template_button_click_15_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.disposeSelectedItems());\n    });\n    i0.ɵɵtemplate(16, StockListComponent_div_46_span_16_Template, 1, 0, \"span\", 30);\n    i0.ɵɵtext(17, \" Dispose Selected Items \");\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.loading);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.loading);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.loading);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.loading);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r2.modalLoading);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r2.selectedDisposeItems.length === 0 || !ctx_r2.disposeForm.locationId || ctx_r2.modalLoading);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.modalLoading);\n  }\n}\nfunction StockListComponent_div_47_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 56);\n  }\n}\nexport let StockListComponent = /*#__PURE__*/(() => {\n  class StockListComponent {\n    constructor(stockService, itemService, locationService, router, accountService) {\n      this.stockService = stockService;\n      this.itemService = itemService;\n      this.locationService = locationService;\n      this.router = router;\n      this.accountService = accountService;\n      this.Role = Role;\n      this.stocks = [];\n      this.itemsMap = {};\n      this.totalItems = 0;\n      this.totalInventoryPrice = 0;\n      this.availableStockMap = {};\n      // Make Object.keys available in template\n      this.Object = Object;\n    }\n    ngOnInit() {\n      // Load items first to map itemId → item name\n      this.itemService.getAll().subscribe(items => {\n        this.itemsMap = items.reduce((map, item) => {\n          map[item.id] = item.name;\n          return map;\n        }, {});\n        this.loadStocks();\n        this.loadAvailableStock();\n      });\n    }\n    loadStocks() {\n      this.stockService.getAll().subscribe({\n        next: stocks => {\n          this.stocks = stocks;\n          this.calculateTotals();\n          this.loadAvailableStock(); // Reload available stock after stocks are loaded\n        },\n        error: error => {\n          console.error('Error fetching stocks:', error);\n        }\n      });\n    }\n    getItemName(itemId) {\n      return this.itemsMap[itemId] || 'Unknown';\n    }\n    getLocationName(stock) {\n      return stock.location ? stock.location.name : 'No Location';\n    }\n    calculateTotals() {\n      // Sum total items and inventory value\n      this.totalItems = this.stocks.reduce((sum, s) => sum + (s.quantity || 0), 0);\n      this.totalInventoryPrice = this.stocks.reduce((sum, s) => sum + (s.price || 0) * (s.quantity || 0), 0);\n    }\n    getCategoryName(stock) {\n      return stock.item?.category?.name || 'No Category';\n    }\n    getBrandName(stock) {\n      return stock.item?.brand?.name || 'No Brand';\n    }\n    viewStock(id) {\n      this.router.navigate(['/stocks/view', id]);\n    }\n    editStock(id) {\n      this.router.navigate(['/stocks/edit', id]);\n    }\n    deleteStock(id) {\n      if (confirm('Are you sure you want to delete this stock record?')) {\n        this.stockService.delete(id).subscribe(() => this.loadStocks());\n      }\n    }\n    loadAvailableStock() {\n      // Get unique item IDs from stocks\n      const itemIds = [...new Set(this.stocks.map(stock => stock.itemId))];\n      // Load available stock for each item\n      itemIds.forEach(itemId => {\n        this.stockService.getAvailableStock(itemId).subscribe({\n          next: data => {\n            this.availableStockMap[itemId] = data.availableStock;\n          },\n          error: error => {\n            console.error('Error loading available stock for item', itemId, error);\n          }\n        });\n      });\n    }\n    // Calculate available stock for a specific item based on all its stock operations\n    calculateAvailableStockForItem(itemId) {\n      const itemStocks = this.stocks.filter(stock => stock.itemId === itemId);\n      let availableStock = 0;\n      itemStocks.forEach(stock => {\n        if (stock.type === 'ADD') {\n          availableStock += stock.quantity;\n        } else if (stock.type === 'DISPOSE') {\n          availableStock -= stock.quantity;\n        }\n      });\n      // Ensure stock doesn't go negative\n      return Math.max(0, availableStock);\n    }\n    getAvailableStock(itemId) {\n      return this.availableStockMap[itemId] || 0;\n    }\n    getItemsWithAvailableStock() {\n      const uniqueItemIds = [...new Set(this.stocks.map(stock => stock.itemId))];\n      return uniqueItemIds.filter(itemId => this.calculateAvailableStockForItem(itemId) > 0).length;\n    }\n    hasRole(roles) {\n      const account = this.accountService.accountValue;\n      if (!account) return false;\n      return roles.some(role => role === account.role);\n    }\n    // Modal methods\n    openDisposeModal() {\n      this.showDisposeModal = true;\n      this.loading = true;\n      // Load data for modal\n      this.loadItemsWithStock();\n      this.loadLocations();\n      // Set loading to false after a short delay to allow data to load\n      setTimeout(() => {\n        this.loading = false;\n      }, 500);\n    }\n    closeDisposeModal() {\n      this.showDisposeModal = false;\n      this.selectedDisposeItems = [];\n      this.disposeForm = {\n        locationId: '',\n        price: 0,\n        remarks: ''\n      };\n    }\n    loadItemsWithStock() {\n      // Get unique items that have available stock\n      const uniqueItems = new Map();\n      this.stocks.forEach(stock => {\n        const availableStock = this.calculateAvailableStockForItem(stock.itemId);\n        if (availableStock > 0) {\n          const itemKey = `${stock.itemId}-${stock.item?.name}`;\n          if (!uniqueItems.has(itemKey)) {\n            uniqueItems.set(itemKey, {\n              id: stock.itemId,\n              name: stock.item?.name || 'Unknown Item',\n              category: stock.item?.category?.name || 'No Category',\n              brand: stock.item?.brand?.name || 'No Brand',\n              availableStock: availableStock\n            });\n          }\n        }\n      });\n      this.itemsWithStock = Array.from(uniqueItems.values());\n      // Show message if no items available\n      if (this.itemsWithStock.length === 0) {\n        alert('No items with available stock found');\n        this.closeDisposeModal();\n      }\n    }\n    loadLocations() {\n      this.locationService.getAll().subscribe({\n        next: locations => {\n          this.locations = locations;\n        },\n        error: error => {\n          console.error('Error loading locations:', error);\n          alert('Error loading storage locations');\n        }\n      });\n    }\n    toggleDisposeItemSelection(item) {\n      const index = this.selectedDisposeItems.findIndex(i => i.id === item.id);\n      if (index > -1) {\n        this.selectedDisposeItems.splice(index, 1);\n      } else {\n        this.selectedDisposeItems.push(item);\n      }\n    }\n    isDisposeItemSelected(item) {\n      return this.selectedDisposeItems.some(i => i.id === item.id);\n    }\n    disposeSelectedItems() {\n      if (this.selectedDisposeItems.length === 0) {\n        alert('Please select items to dispose');\n        return;\n      }\n      if (!this.disposeForm.locationId) {\n        alert('Please select a location');\n        return;\n      }\n      if (!confirm(`Are you sure you want to dispose the selected items?`)) {\n        return;\n      }\n      this.modalLoading = true;\n      // Create dispose entries for each selected item\n      const disposeObservables = this.selectedDisposeItems.map(item => {\n        const disposeData = {\n          itemId: item.id,\n          quantity: item.availableStock,\n          type: 'DISPOSE',\n          locationId: this.disposeForm.locationId,\n          price: this.disposeForm.price,\n          remarks: this.disposeForm.remarks\n        };\n        return this.stockService.create(disposeData);\n      });\n      // Use forkJoin for parallel execution\n      forkJoin(disposeObservables).subscribe({\n        next: () => {\n          alert('Items disposed successfully');\n          this.closeDisposeModal();\n          this.loadStocks();\n        },\n        error: error => {\n          console.error('Error disposing items:', error);\n          alert('Error disposing items');\n          this.modalLoading = false;\n        },\n        complete: () => {\n          this.modalLoading = false;\n        }\n      });\n    }\n    toggleAllDisposeItems(event) {\n      if (event.target.checked) {\n        this.selectedDisposeItems = [...this.itemsWithStock];\n      } else {\n        this.selectedDisposeItems = [];\n      }\n    }\n    // Form change handlers\n    onLocationChange(event) {\n      this.disposeForm.locationId = event.target.value;\n    }\n    onPriceChange(event) {\n      this.disposeForm.price = parseFloat(event.target.value) || 0;\n    }\n    onRemarksChange(event) {\n      this.disposeForm.remarks = event.target.value;\n    }\n    getTotalSelectedItems() {\n      return this.selectedDisposeItems.reduce((sum, item) => sum + item.availableStock, 0);\n    }\n    static #_ = this.ɵfac = function StockListComponent_Factory(t) {\n      return new (t || StockListComponent)(i0.ɵɵdirectiveInject(i1.StockService), i0.ɵɵdirectiveInject(i2.ItemService), i0.ɵɵdirectiveInject(i3.StorageLocationService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i5.AccountService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: StockListComponent,\n      selectors: [[\"app-stock-list\"]],\n      decls: 48,\n      vars: 18,\n      consts: [[1, \"container\", \"mt-3\"], [1, \"mb-3\"], [\"routerLink\", \"/stocks/add\", \"class\", \"btn btn-primary me-2\", 4, \"ngIf\"], [\"routerLink\", \"/stocks/dispose\", \"class\", \"btn btn-danger\", 4, \"ngIf\"], [1, \"alert\", \"alert-info\"], [1, \"table\", \"table-bordered\", \"table-striped\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"modal fade show\", \"tabindex\", \"-1\", \"role\", \"dialog\", 4, \"ngIf\"], [\"class\", \"modal-backdrop fade show\", 4, \"ngIf\"], [\"routerLink\", \"/stocks/add\", 1, \"btn\", \"btn-primary\", \"me-2\"], [\"routerLink\", \"/stocks/dispose\", 1, \"btn\", \"btn-danger\"], [1, \"badge\"], [1, \"btn\", \"btn-sm\", \"btn-primary\", \"mr-2\", 3, \"click\"], [\"class\", \"btn btn-sm btn-warning mr-2\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"btn btn-sm btn-danger\", 3, \"click\", 4, \"ngIf\"], [1, \"btn\", \"btn-sm\", \"btn-warning\", \"mr-2\", 3, \"click\"], [1, \"btn\", \"btn-sm\", \"btn-danger\", 3, \"click\"], [\"tabindex\", \"-1\", \"role\", \"dialog\", 1, \"modal\", \"fade\", \"show\"], [\"role\", \"document\", 1, \"modal-dialog\", \"modal-xl\"], [1, \"modal-content\"], [1, \"modal-header\"], [1, \"modal-title\"], [\"type\", \"button\", 1, \"btn-close\", 3, \"click\"], [1, \"modal-body\"], [\"class\", \"text-center py-4\", 4, \"ngIf\"], [\"class\", \"row\", 4, \"ngIf\"], [\"class\", \"row mt-3\", 4, \"ngIf\"], [1, \"modal-footer\"], [\"type\", \"button\", 1, \"btn\", \"btn-secondary\", 3, \"click\", \"disabled\"], [\"type\", \"button\", 1, \"btn\", \"btn-danger\", 3, \"click\", \"disabled\"], [\"class\", \"spinner-border spinner-border-sm me-1\", 4, \"ngIf\"], [1, \"text-center\", \"py-4\"], [\"role\", \"status\", 1, \"spinner-border\"], [1, \"visually-hidden\"], [1, \"mt-2\"], [1, \"row\"], [1, \"col-12\"], [1, \"table-responsive\", 2, \"max-height\", \"400px\", \"overflow-y\", \"auto\"], [1, \"table\", \"table-sm\", \"table-bordered\"], [1, \"table-light\"], [\"type\", \"checkbox\", 3, \"change\"], [3, \"table-primary\", \"click\", 4, \"ngFor\", \"ngForOf\"], [3, \"click\"], [\"type\", \"checkbox\", 3, \"click\", \"checked\"], [1, \"badge\", \"badge-success\"], [1, \"row\", \"mt-3\"], [1, \"col-md-4\"], [1, \"form-label\"], [1, \"form-control\", 3, \"change\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"number\", \"step\", \"0.01\", \"min\", \"0\", 1, \"form-control\", 3, \"input\", \"value\"], [\"type\", \"text\", \"placeholder\", \"Reason for disposal\", 1, \"form-control\", 3, \"input\", \"value\"], [3, \"value\"], [4, \"ngIf\"], [1, \"spinner-border\", \"spinner-border-sm\", \"me-1\"], [1, \"modal-backdrop\", \"fade\", \"show\"]],\n      template: function StockListComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"h3\");\n          i0.ɵɵtext(2, \"Stock Logs\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"div\", 1);\n          i0.ɵɵtemplate(4, StockListComponent_a_4_Template, 2, 0, \"a\", 2)(5, StockListComponent_a_5_Template, 2, 0, \"a\", 3);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(6, \"div\", 4)(7, \"strong\");\n          i0.ɵɵtext(8, \"Total Items:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(9);\n          i0.ɵɵelementStart(10, \"strong\");\n          i0.ɵɵtext(11, \"Total Inventory Price:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(12);\n          i0.ɵɵpipe(13, \"currency\");\n          i0.ɵɵelementStart(14, \"strong\");\n          i0.ɵɵtext(15, \"Items with Available Stock:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(16);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(17, \"table\", 5)(18, \"thead\")(19, \"tr\")(20, \"th\");\n          i0.ɵɵtext(21, \"Item Name\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(22, \"th\");\n          i0.ɵɵtext(23, \"Category\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(24, \"th\");\n          i0.ɵɵtext(25, \"Brand\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(26, \"th\");\n          i0.ɵɵtext(27, \"Quantity\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"th\");\n          i0.ɵɵtext(29, \"Price\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(30, \"th\");\n          i0.ɵɵtext(31, \"Total Price\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(32, \"th\");\n          i0.ɵɵtext(33, \"Type\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(34, \"th\");\n          i0.ɵɵtext(35, \"Location\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(36, \"th\");\n          i0.ɵɵtext(37, \"Available Stock\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(38, \"th\");\n          i0.ɵɵtext(39, \"Remarks\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(40, \"th\");\n          i0.ɵɵtext(41, \"Date\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(42, \"th\");\n          i0.ɵɵtext(43, \"Actions\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(44, \"tbody\");\n          i0.ɵɵtemplate(45, StockListComponent_tr_45_Template, 32, 34, \"tr\", 6);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(46, StockListComponent_div_46_Template, 18, 7, \"div\", 7)(47, StockListComponent_div_47_Template, 1, 0, \"div\", 8);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngIf\", ctx.hasRole(i0.ɵɵpureFunction2(12, _c0, ctx.Role.SuperAdmin, ctx.Role.Admin)));\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.hasRole(i0.ɵɵpureFunction2(15, _c0, ctx.Role.SuperAdmin, ctx.Role.Admin)));\n          i0.ɵɵadvance(4);\n          i0.ɵɵtextInterpolate1(\" \", ctx.totalItems, \" | \");\n          i0.ɵɵadvance(3);\n          i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind3(13, 8, ctx.totalInventoryPrice, \"PHP\", \"symbol\"), \" | \");\n          i0.ɵɵadvance(4);\n          i0.ɵɵtextInterpolate1(\" \", ctx.getItemsWithAvailableStock(), \" \");\n          i0.ɵɵadvance(29);\n          i0.ɵɵproperty(\"ngForOf\", ctx.stocks);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.showDisposeModal);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.showDisposeModal);\n        }\n      },\n      dependencies: [i6.NgForOf, i6.NgIf, i7.NgSelectOption, i7.ɵNgSelectMultipleOption, i4.RouterLink, i6.CurrencyPipe, i6.DatePipe],\n      styles: [\".modal.show[_ngcontent-%COMP%] {\\n      display: block !important;\\n    }\\n    .table-responsive[_ngcontent-%COMP%] {\\n      border: 1px solid #dee2e6;\\n    }\\n    .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] {\\n      cursor: pointer;\\n    }\\n    .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover {\\n      background-color: #f8f9fa;\\n    }\\n    .table-primary[_ngcontent-%COMP%] {\\n      background-color: #cce5ff !important;\\n    }\\n    .badge-success[_ngcontent-%COMP%] {\\n      background-color: #28a745;\\n    }\\n    .badge-danger[_ngcontent-%COMP%] {\\n      background-color: #dc3545;\\n    }\"]\n    });\n  }\n  return StockListComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}