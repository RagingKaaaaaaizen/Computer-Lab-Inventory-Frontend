{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Role } from '../_models';\nlet StockListComponent = class StockListComponent {\n  constructor(stockService, itemService, locationService, router, accountService) {\n    this.stockService = stockService;\n    this.itemService = itemService;\n    this.locationService = locationService;\n    this.router = router;\n    this.accountService = accountService;\n    this.Role = Role;\n    this.stocks = [];\n    this.itemsMap = {};\n    this.totalItems = 0;\n    this.totalInventoryPrice = 0;\n    this.availableStockMap = {};\n    // Make Object.keys available in template\n    this.Object = Object;\n  }\n  ngOnInit() {\n    // Load items first to map itemId â†’ item name\n    this.itemService.getAll().subscribe(items => {\n      this.itemsMap = items.reduce((map, item) => {\n        map[item.id] = item.name;\n        return map;\n      }, {});\n      this.loadStocks();\n      this.loadAvailableStock();\n    });\n  }\n  loadStocks() {\n    this.stockService.getAll().subscribe({\n      next: stocks => {\n        this.stocks = stocks;\n        this.calculateTotals();\n        this.loadAvailableStock(); // Reload available stock after stocks are loaded\n      },\n      error: error => {\n        console.error('Error fetching stocks:', error);\n      }\n    });\n  }\n  getItemName(itemId) {\n    return this.itemsMap[itemId] || 'Unknown';\n  }\n  getLocationName(stock) {\n    return stock.location ? stock.location.name : 'No Location';\n  }\n  calculateTotals() {\n    // Sum total items and inventory value\n    this.totalItems = this.stocks.reduce((sum, s) => sum + (s.quantity || 0), 0);\n    this.totalInventoryPrice = this.stocks.reduce((sum, s) => sum + (s.price || 0) * (s.quantity || 0), 0);\n  }\n  getCategoryName(stock) {\n    return stock.item?.category?.name || 'No Category';\n  }\n  getBrandName(stock) {\n    return stock.item?.brand?.name || 'No Brand';\n  }\n  viewStock(id) {\n    this.router.navigate(['/stocks/view', id]);\n  }\n  editStock(id) {\n    this.router.navigate(['/stocks/edit', id]);\n  }\n  deleteStock(id) {\n    if (confirm('Are you sure you want to delete this stock record?')) {\n      this.stockService.delete(id).subscribe(() => this.loadStocks());\n    }\n  }\n  loadAvailableStock() {\n    // Get unique item IDs from stocks\n    const itemIds = [...new Set(this.stocks.map(stock => stock.itemId))];\n    // Load available stock for each item\n    itemIds.forEach(itemId => {\n      this.stockService.getAvailableStock(itemId).subscribe({\n        next: data => {\n          this.availableStockMap[itemId] = data.availableStock;\n        },\n        error: error => {\n          console.error('Error loading available stock for item', itemId, error);\n        }\n      });\n    });\n  }\n  // Calculate available stock for a specific item based on all its stock operations\n  calculateAvailableStockForItem(itemId) {\n    const itemStocks = this.stocks.filter(stock => stock.itemId === itemId);\n    let availableStock = 0;\n    itemStocks.forEach(stock => {\n      if (stock.type === 'ADD') {\n        availableStock += stock.quantity;\n      } else if (stock.type === 'DISPOSE') {\n        availableStock -= stock.quantity;\n      }\n    });\n    // Ensure stock doesn't go negative\n    return Math.max(0, availableStock);\n  }\n  getAvailableStock(itemId) {\n    return this.availableStockMap[itemId] || 0;\n  }\n  getItemsWithAvailableStock() {\n    const uniqueItemIds = [...new Set(this.stocks.map(stock => stock.itemId))];\n    return uniqueItemIds.filter(itemId => this.calculateAvailableStockForItem(itemId) > 0).length;\n  }\n  hasRole(roles) {\n    const account = this.accountService.accountValue;\n    if (!account) return false;\n    return roles.some(role => role === account.role);\n  }\n};\nStockListComponent = __decorate([Component({\n  selector: 'app-stock-list',\n  templateUrl: './stock-list.component.html'\n})], StockListComponent);\nexport { StockListComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}